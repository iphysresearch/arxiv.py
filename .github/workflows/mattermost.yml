name: Notify Mattermost

on:
  push:
    branches: [ master, main ]
  pull_request:
    types: [opened, closed, reopened, merged]
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send notification to Mattermost
        run: |
          # æ„é€ ä¸€æ¡ç®€å•æ¶ˆæ¯ï¼ŒåŒ…å« repo åç§°ã€äº‹ä»¶ç±»å‹å’Œè§¦å‘ç”¨æˆ·
          payload=$(jq -n \
            --arg repo "${{ github.repository }}" \
            --arg event "${{ github.event_name }}" \
            --arg actor "${{ github.actor }}" \
            --arg ref "${{ github.ref }}" \
            '{text: ("ğŸ“¢ GitHub Event: \($event)\nğŸ“‚ Repo: \($repo)\nğŸ‘¤ Actor: \($actor)\nğŸŒ¿ Ref: \($ref)") }')
          
          curl -X POST -H 'Content-Type: application/json' \
            -d "$payload" \
            ${{ secrets.MATTERMOST_WEBHOOK_URL }}
